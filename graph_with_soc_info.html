<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Graph by t (directed trace + relayout)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
  html, body { height: 100%; margin: 0; }
  .row {
    padding: 8px 12px; border-bottom: 1px solid #e5e7eb;
    display: flex; gap: 16px; flex-wrap: wrap; align-items: center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }
  #legend, #vlegend { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
  .chip { display: inline-flex; gap: 6px; align-items: center;
          padding: 2px 8px; border-radius: 999px; background: #f3f4f6; font-size: 12px; }
  .swatch { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
  #network { width: 100%; height: calc(100% - 168px); }
  label { user-select: none; }
  .btn { padding: 4px 10px; border:1px solid #e5e7eb; background:#fff; border-radius:8px; cursor:pointer; }
  div.vis-network div.vis-tooltip { white-space: pre-line; max-width: 520px; }
</style>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
  <div class="row">
    <div><strong>t columns:</strong> 1, 2, 3, 4</div>
    <div><strong>zones:</strong> (NA), 308.0, 317.0</div>
    <label><input type="checkbox" id="toggleLabels"> show labels</label>
    <label title="只保留 flow>0 的边，并隐藏未参与这些边的节点">
      <input type="checkbox" id="flowOnly"> flow-only
    </label>
    <label><input type="checkbox" id="showVirtual" checked> show virtual nodes</label>
  </div>

  <div class="row">
    <div id="legend"><strong>Edge types:</strong><label class="chip"><span class="swatch" style="background:#1f77b4"></span><input type="checkbox" class="etype" value="chg_enter" checked/> chg_enter</label><label class="chip"><span class="swatch" style="background:#ff7f0e"></span><input type="checkbox" class="etype" value="chg_occ" checked/> chg_occ</label><label class="chip"><span class="swatch" style="background:#2ca02c"></span><input type="checkbox" class="etype" value="chg_step" checked/> chg_step</label><label class="chip"><span class="swatch" style="background:#d62728"></span><input type="checkbox" class="etype" value="from_source" checked/> from_source</label><label class="chip"><span class="swatch" style="background:#9467bd"></span><input type="checkbox" class="etype" value="idle" checked/> idle</label><label class="chip"><span class="swatch" style="background:#8c564b"></span><input type="checkbox" class="etype" value="svc_enter" checked/> svc_enter</label><label class="chip"><span class="swatch" style="background:#e377c2"></span><input type="checkbox" class="etype" value="svc_exit" checked/> svc_exit</label><label class="chip"><span class="swatch" style="background:#7f7f7f"></span><input type="checkbox" class="etype" value="svc_gate" checked/> svc_gate</label><label class="chip"><span class="swatch" style="background:#bcbd22"></span><input type="checkbox" class="etype" value="to_sink" checked/> to_sink</label><label class="chip"><span class="swatch" style="background:#17becf"></span><input type="checkbox" class="etype" value="tochg" checked/> tochg</label></div>
  </div>

  <div class="row">
    <div id="vlegend"><strong>Virtual categories:</strong><label class="chip"><span class="swatch" style="background:#06b6d4"></span><input type="checkbox" class="vcat" value="charging" checked/> charging</label><label class="chip"><span class="swatch" style="background:#ef4444"></span><input type="checkbox" class="vcat" value="service" checked/> service</label><label class="chip"><span class="swatch" style="background:#9ca3af"></span><input type="checkbox" class="vcat" value="unknown" checked/> unknown</label></div>
  </div>

  <div class="row">
    <label title="点击节点后，仅显示该节点与其所有直连边及对端节点，并动态重排">
      <input type="checkbox" id="focusOnClick"> focus on click
    </label>
    <button class="btn" id="clearFocus" title="退出聚焦并恢复原始布局">clear</button>

    <label title="点击节点后，仅保留其在 flow>0 的有向通路，并按层级动态重排">
      <input type="checkbox" id="tracePath"> trace path (flow)
    </label>
    <span>
      path dir:
      <label><input type="radio" name="pathdir" value="forward"> forward</label>
      <label><input type="radio" name="pathdir" value="backward"> backward</label>
      <label><input type="radio" name="pathdir" value="both" checked> both</label>
    </span>
    <button class="btn" id="clearPath" title="关闭通路模式并恢复筛选">clear path</button>
  </div>

  <div id="network"></div>

  <script>
    const ALL_NODES = [{"id": "10", "label": " ", "title": "Node: 10\nt: 1\nzone: 308.0\nsoc: 100\nsupply: 0", "x": 0.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "21", "label": " ", "title": "Node: 21\nt: 2\nzone: 308.0\nsoc: 100\nsupply: 0", "x": 260.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "23", "label": " ", "title": "Node: 23\nt: 3\nzone: 308.0\nsoc: 10\nsupply: 0", "x": 494.0, "y": -446.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "24", "label": " ", "title": "Node: 24\nt: 3\nzone: 308.0\nsoc: 20\nsupply: 0", "x": 520.0, "y": -446.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "25", "label": " ", "title": "Node: 25\nt: 3\nzone: 308.0\nsoc: 30\nsupply: 0", "x": 546.0, "y": -446.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "26", "label": " ", "title": "Node: 26\nt: 3\nzone: 308.0\nsoc: 40\nsupply: 0", "x": 494.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "27", "label": " ", "title": "Node: 27\nt: 3\nzone: 308.0\nsoc: 50\nsupply: 0", "x": 520.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "28", "label": " ", "title": "Node: 28\nt: 3\nzone: 308.0\nsoc: 60\nsupply: 0", "x": 546.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "29", "label": " ", "title": "Node: 29\nt: 3\nzone: 308.0\nsoc: 70\nsupply: 0", "x": 494.0, "y": -394.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "32", "label": " ", "title": "Node: 32\nt: 3\nzone: 308.0\nsoc: 100\nsupply: 0", "x": 520.0, "y": -394.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "33", "label": " ", "title": "Node: 33\nt: 4\nzone: 308.0\nsoc: 0\nsupply: 0", "x": 741.0, "y": -446.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "34", "label": " ", "title": "Node: 34\nt: 4\nzone: 308.0\nsoc: 10\nsupply: 0", "x": 767.0, "y": -446.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "35", "label": " ", "title": "Node: 35\nt: 4\nzone: 308.0\nsoc: 20\nsupply: 0", "x": 793.0, "y": -446.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "36", "label": " ", "title": "Node: 36\nt: 4\nzone: 308.0\nsoc: 30\nsupply: 0", "x": 819.0, "y": -446.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "37", "label": " ", "title": "Node: 37\nt: 4\nzone: 308.0\nsoc: 40\nsupply: 0", "x": 741.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "38", "label": " ", "title": "Node: 38\nt: 4\nzone: 308.0\nsoc: 50\nsupply: 0", "x": 767.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "39", "label": " ", "title": "Node: 39\nt: 4\nzone: 308.0\nsoc: 60\nsupply: 0", "x": 793.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "40", "label": " ", "title": "Node: 40\nt: 4\nzone: 308.0\nsoc: 70\nsupply: 0", "x": 819.0, "y": -420.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "41", "label": " ", "title": "Node: 41\nt: 4\nzone: 308.0\nsoc: 80\nsupply: 0", "x": 741.0, "y": -394.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "42", "label": " ", "title": "Node: 42\nt: 4\nzone: 308.0\nsoc: 90\nsupply: 0", "x": 767.0, "y": -394.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "43", "label": " ", "title": "Node: 43\nt: 4\nzone: 308.0\nsoc: 100\nsupply: 0", "x": 793.0, "y": -394.0, "fixed": true, "group": "zone_308.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "54", "label": " ", "title": "Node: 54\nt: 1\nzone: 317.0\nsoc: 100\nsupply: 0", "x": 0.0, "y": -840.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "65", "label": " ", "title": "Node: 65\nt: 2\nzone: 317.0\nsoc: 100\nsupply: 0", "x": 260.0, "y": -840.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "68", "label": " ", "title": "Node: 68\nt: 3\nzone: 317.0\nsoc: 20\nsupply: 0", "x": 494.0, "y": -853.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "69", "label": " ", "title": "Node: 69\nt: 3\nzone: 317.0\nsoc: 30\nsupply: 0", "x": 520.0, "y": -853.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "70", "label": " ", "title": "Node: 70\nt: 3\nzone: 317.0\nsoc: 40\nsupply: 0", "x": 546.0, "y": -853.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "71", "label": " ", "title": "Node: 71\nt: 3\nzone: 317.0\nsoc: 50\nsupply: 0", "x": 494.0, "y": -827.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "72", "label": " ", "title": "Node: 72\nt: 3\nzone: 317.0\nsoc: 60\nsupply: 0", "x": 520.0, "y": -827.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "76", "label": " ", "title": "Node: 76\nt: 3\nzone: 317.0\nsoc: 100\nsupply: 0", "x": 546.0, "y": -827.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "77", "label": " ", "title": "Node: 77\nt: 4\nzone: 317.0\nsoc: 0\nsupply: 0", "x": 741.0, "y": -866.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "78", "label": " ", "title": "Node: 78\nt: 4\nzone: 317.0\nsoc: 10\nsupply: 0", "x": 767.0, "y": -866.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "79", "label": " ", "title": "Node: 79\nt: 4\nzone: 317.0\nsoc: 20\nsupply: 0", "x": 793.0, "y": -866.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "80", "label": " ", "title": "Node: 80\nt: 4\nzone: 317.0\nsoc: 30\nsupply: 0", "x": 819.0, "y": -866.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "81", "label": " ", "title": "Node: 81\nt: 4\nzone: 317.0\nsoc: 40\nsupply: 0", "x": 741.0, "y": -840.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "82", "label": " ", "title": "Node: 82\nt: 4\nzone: 317.0\nsoc: 50\nsupply: 0", "x": 767.0, "y": -840.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "83", "label": " ", "title": "Node: 83\nt: 4\nzone: 317.0\nsoc: 60\nsupply: 0", "x": 793.0, "y": -840.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "84", "label": " ", "title": "Node: 84\nt: 4\nzone: 317.0\nsoc: 70\nsupply: 0", "x": 819.0, "y": -840.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "85", "label": " ", "title": "Node: 85\nt: 4\nzone: 317.0\nsoc: 80\nsupply: 0", "x": 741.0, "y": -814.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "86", "label": " ", "title": "Node: 86\nt: 4\nzone: 317.0\nsoc: 90\nsupply: 0", "x": 767.0, "y": -814.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "87", "label": " ", "title": "Node: 87\nt: 4\nzone: 317.0\nsoc: 100\nsupply: 0", "x": 793.0, "y": -814.0, "fixed": true, "group": "zone_317.0", "is_virtual": false, "vcat": "", "shape": "dot", "size": 8}, {"id": "-2065537959644669696", "label": " ", "title": "Node: -2065537959644669696\nt: virtual\nzone: (NA)\nvirtual category: unknown\nsupply: 200", "x": 0.0, "y": 420.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "unknown", "shape": "diamond", "size": 8, "color": {"background": "#9ca3af", "border": "#9ca3af"}}, {"id": "-8724511148913573888", "label": " ", "title": "Node: -8724511148913573888\nt: virtual\nzone: (NA)\nvirtual category: unknown\nsupply: -200", "x": 780.0, "y": 420.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "unknown", "shape": "diamond", "size": 8, "color": {"background": "#9ca3af", "border": "#9ca3af"}}, {"id": "-8608577930118051840", "label": " ", "title": "Node: -8608577930118051840\nt: virtual\nzone: (NA)\nvirtual category: charging\nsupply: 0", "x": 520.0, "y": 140.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "charging", "shape": "diamond", "size": 8, "color": {"background": "#06b6d4", "border": "#06b6d4"}}, {"id": "-8500640205483802624", "label": " ", "title": "Node: -8500640205483802624\nt: virtual\nzone: (NA)\nvirtual category: charging\nsupply: 0", "x": 780.0, "y": 140.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "charging", "shape": "diamond", "size": 8, "color": {"background": "#06b6d4", "border": "#06b6d4"}}, {"id": "-6972045642524965888", "label": " ", "title": "Node: -6972045642524965888\nt: virtual\nzone: (NA)\nvirtual category: service\nsupply: 0", "x": 767.0, "y": 280.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "service", "shape": "diamond", "size": 8, "color": {"background": "#ef4444", "border": "#ef4444"}}, {"id": "-328203732588839040", "label": " ", "title": "Node: -328203732588839040\nt: virtual\nzone: (NA)\nvirtual category: service\nsupply: 0", "x": 793.0, "y": 280.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "service", "shape": "diamond", "size": 8, "color": {"background": "#ef4444", "border": "#ef4444"}}, {"id": "-6832668076301775872", "label": " ", "title": "Node: -6832668076301775872\nt: virtual\nzone: (NA)\nvirtual category: service\nsupply: 0", "x": 247.0, "y": 280.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "service", "shape": "diamond", "size": 8, "color": {"background": "#ef4444", "border": "#ef4444"}}, {"id": "-2113565832596246016", "label": " ", "title": "Node: -2113565832596246016\nt: virtual\nzone: (NA)\nvirtual category: service\nsupply: 0", "x": 273.0, "y": 280.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "service", "shape": "diamond", "size": 8, "color": {"background": "#ef4444", "border": "#ef4444"}}, {"id": "-6071307011258056704", "label": " ", "title": "Node: -6071307011258056704\nt: virtual\nzone: (NA)\nvirtual category: service\nsupply: 0", "x": 507.0, "y": 280.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "service", "shape": "diamond", "size": 8, "color": {"background": "#ef4444", "border": "#ef4444"}}, {"id": "-1312670775491030016", "label": " ", "title": "Node: -1312670775491030016\nt: virtual\nzone: (NA)\nvirtual category: service\nsupply: 0", "x": 533.0, "y": 280.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "service", "shape": "diamond", "size": 8, "color": {"background": "#ef4444", "border": "#ef4444"}}, {"id": "-5303467566796545024", "label": " ", "title": "Node: -5303467566796545024\nt: virtual\nzone: (NA)\nvirtual category: charging\nsupply: 0", "x": -273.0, "y": 140.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "charging", "shape": "diamond", "size": 8, "color": {"background": "#06b6d4", "border": "#06b6d4"}}, {"id": "-5204973881738096640", "label": " ", "title": "Node: -5204973881738096640\nt: virtual\nzone: (NA)\nvirtual category: charging\nsupply: 0", "x": -247.0, "y": 140.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "charging", "shape": "diamond", "size": 8, "color": {"background": "#06b6d4", "border": "#06b6d4"}}, {"id": "-4938161853202029568", "label": " ", "title": "Node: -4938161853202029568\nt: virtual\nzone: (NA)\nvirtual category: charging\nsupply: 0", "x": -13.0, "y": 140.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "charging", "shape": "diamond", "size": 8, "color": {"background": "#06b6d4", "border": "#06b6d4"}}, {"id": "-4728362194768353280", "label": " ", "title": "Node: -4728362194768353280\nt: virtual\nzone: (NA)\nvirtual category: charging\nsupply: 0", "x": 13.0, "y": 140.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "charging", "shape": "diamond", "size": 8, "color": {"background": "#06b6d4", "border": "#06b6d4"}}, {"id": "-4702087699455048704", "label": " ", "title": "Node: -4702087699455048704\nt: virtual\nzone: (NA)\nvirtual category: charging\nsupply: 0", "x": 247.0, "y": 140.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "charging", "shape": "diamond", "size": 8, "color": {"background": "#06b6d4", "border": "#06b6d4"}}, {"id": "-316543663216743104", "label": " ", "title": "Node: -316543663216743104\nt: virtual\nzone: (NA)\nvirtual category: charging\nsupply: 0", "x": 273.0, "y": 140.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "charging", "shape": "diamond", "size": 8, "color": {"background": "#06b6d4", "border": "#06b6d4"}}, {"id": "-2755364372539861504", "label": " ", "title": "Node: -2755364372539861504\nt: virtual\nzone: (NA)\nvirtual category: service\nsupply: 0", "x": -13.0, "y": 280.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "service", "shape": "diamond", "size": 8, "color": {"background": "#ef4444", "border": "#ef4444"}}, {"id": "-242693579967937152", "label": " ", "title": "Node: -242693579967937152\nt: virtual\nzone: (NA)\nvirtual category: service\nsupply: 0", "x": 13.0, "y": 280.0, "fixed": true, "group": "zone_(NA)", "is_virtual": true, "vcat": "service", "shape": "diamond", "size": 8, "color": {"background": "#ef4444", "border": "#ef4444"}}];
    const ALL_EDGES = [{"from": "24", "to": "35", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 24 → 35\ntype: idle\nflow: 10\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 10.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "28", "to": "39", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 28 → 39\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "26", "to": "37", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 26 → 37\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "68", "to": "79", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 68 → 79\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "70", "to": "81", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 70 → 81\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "54", "to": "65", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 54 → 65\ntype: idle\nflow: 10\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 10.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "21", "to": "32", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 21 → 32\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "71", "to": "82", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 71 → 82\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "29", "to": "40", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 29 → 40\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "32", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 32 → 43\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "65", "to": "76", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 65 → 76\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "72", "to": "83", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 72 → 83\ntype: idle\nflow: 10\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 10.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "27", "to": "38", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 27 → 38\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "25", "to": "36", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 25 → 36\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "69", "to": "80", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 69 → 80\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "10", "to": "21", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: 10 → 21\ntype: idle\nflow: 170\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 170.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "76", "to": "87", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 76 → 87\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "23", "to": "34", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 23 → 34\ntype: idle\nflow: 0\ncost: 10\ncapacity: ∞", "edge_type": "idle", "flow": 0.0, "dashes": false, "label": "∞", "color": {"color": "#9467bd"}}, {"from": "-6071307011258056704", "to": "69", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6071307011258056704 → 69\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "21", "to": "-6832668076301775872", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 21 → -6832668076301775872\ntype: svc_enter\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "svc_enter", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#8c564b"}}, {"from": "-328203732588839040", "to": "80", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -328203732588839040 → 80\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6071307011258056704", "to": "68", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6071307011258056704 → 68\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-1312670775491030016", "to": "23", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -1312670775491030016 → 23\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6972045642524965888", "to": "35", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6972045642524965888 → 35\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "65", "to": "-2113565832596246016", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 65 → -2113565832596246016\ntype: svc_enter\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "svc_enter", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#8c564b"}}, {"from": "-1312670775491030016", "to": "26", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -1312670775491030016 → 26\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6071307011258056704", "to": "71", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6071307011258056704 → 71\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-2113565832596246016", "to": "-6972045642524965888", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: -2113565832596246016 → -6972045642524965888\ntype: svc_gate\nflow: 10\ncost: -15.7\ncapacity: 10", "edge_type": "svc_gate", "flow": 10.0, "dashes": true, "label": "10", "color": {"color": "#7f7f7f"}}, {"from": "-2755364372539861504", "to": "-6071307011258056704", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: -2755364372539861504 → -6071307011258056704\ntype: svc_gate\nflow: 10\ncost: -15.7\ncapacity: 10", "edge_type": "svc_gate", "flow": 10.0, "dashes": true, "label": "10", "color": {"color": "#7f7f7f"}}, {"from": "-6972045642524965888", "to": "39", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: -6972045642524965888 → 39\ntype: svc_exit\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6972045642524965888", "to": "34", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6972045642524965888 → 34\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-328203732588839040", "to": "82", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -328203732588839040 → 82\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-328203732588839040", "to": "81", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -328203732588839040 → 81\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-1312670775491030016", "to": "25", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -1312670775491030016 → 25\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6972045642524965888", "to": "37", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6972045642524965888 → 37\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6832668076301775872", "to": "-328203732588839040", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: -6832668076301775872 → -328203732588839040\ntype: svc_gate\nflow: 10\ncost: -15.7\ncapacity: 10", "edge_type": "svc_gate", "flow": 10.0, "dashes": true, "label": "10", "color": {"color": "#7f7f7f"}}, {"from": "-6071307011258056704", "to": "70", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6071307011258056704 → 70\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-1312670775491030016", "to": "27", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -1312670775491030016 → 27\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6972045642524965888", "to": "36", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6972045642524965888 → 36\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "54", "to": "-242693579967937152", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 54 → -242693579967937152\ntype: svc_enter\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "svc_enter", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#8c564b"}}, {"from": "-328203732588839040", "to": "79", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -328203732588839040 → 79\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "10", "to": "-2755364372539861504", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 10 → -2755364372539861504\ntype: svc_enter\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "svc_enter", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#8c564b"}}, {"from": "-1312670775491030016", "to": "28", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -1312670775491030016 → 28\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-328203732588839040", "to": "83", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: -328203732588839040 → 83\ntype: svc_exit\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-242693579967937152", "to": "-1312670775491030016", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: -242693579967937152 → -1312670775491030016\ntype: svc_gate\nflow: 10\ncost: -15.7\ncapacity: 10", "edge_type": "svc_gate", "flow": 10.0, "dashes": true, "label": "10", "color": {"color": "#7f7f7f"}}, {"from": "-1312670775491030016", "to": "24", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: -1312670775491030016 → 24\ntype: svc_exit\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6972045642524965888", "to": "38", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -6972045642524965888 → 38\ntype: svc_exit\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-6071307011258056704", "to": "72", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: -6071307011258056704 → 72\ntype: svc_exit\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "svc_exit", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#e377c2"}}, {"from": "-4702087699455048704", "to": "-5303467566796545024", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -4702087699455048704 → -5303467566796545024\ntype: chg_enter\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_enter", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#1f77b4"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 0\ncost: -0.4\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "54", "to": "-4938161853202029568", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 54 → -4938161853202029568\ntype: tochg\nflow: 0\ncost: 1\ncapacity: ∞", "edge_type": "tochg", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#17becf"}}, {"from": "-4702087699455048704", "to": "-5303467566796545024", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -4702087699455048704 → -5303467566796545024\ntype: chg_enter\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_enter", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#1f77b4"}}, {"from": "-8608577930118051840", "to": "32", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 32\ntype: chg_step\nflow: 0\ncost: -0.2\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-4728362194768353280", "to": "-5204973881738096640", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -4728362194768353280 → -5204973881738096640\ntype: chg_enter\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_enter", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#1f77b4"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 60\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 60.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-8608577930118051840", "to": "32", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 32\ntype: chg_step\nflow: 0\ncost: -0.4\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 160\ncost: -1\ncapacity: ∞", "edge_type": "chg_step", "flow": 160.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-8608577930118051840", "to": "29", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 29\ntype: chg_step\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-8608577930118051840", "to": "28", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 28\ntype: chg_step\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 0\ncost: -0.4\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 40\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 40.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 0\ncost: -0.6\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 0\ncost: -1\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-316543663216743104", "to": "-5303467566796545024", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: -316543663216743104 → -5303467566796545024\ntype: chg_enter\nflow: 160\ncost: 0\ncapacity: ∞", "edge_type": "chg_enter", "flow": 160.0, "dashes": true, "label": "∞", "color": {"color": "#1f77b4"}}, {"from": "-4938161853202029568", "to": "-5204973881738096640", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -4938161853202029568 → -5204973881738096640\ntype: chg_enter\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_enter", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#1f77b4"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 0\ncost: -0.8\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 0\ncost: -0.8\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 0\ncost: -0.6\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-8608577930118051840", "to": "27", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 27\ntype: chg_step\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "21", "to": "-316543663216743104", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: 21 → -316543663216743104\ntype: tochg\nflow: 160\ncost: 1\ncapacity: ∞", "edge_type": "tochg", "flow": 160.0, "dashes": true, "label": "∞", "color": {"color": "#17becf"}}, {"from": "-8608577930118051840", "to": "32", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 32\ntype: chg_step\nflow: 0\ncost: -0.4\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-4938161853202029568", "to": "-5204973881738096640", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -4938161853202029568 → -5204973881738096640\ntype: chg_enter\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_enter", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#1f77b4"}}, {"from": "-8608577930118051840", "to": "29", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 29\ntype: chg_step\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "65", "to": "-4702087699455048704", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 65 → -4702087699455048704\ntype: tochg\nflow: 0\ncost: 1\ncapacity: ∞", "edge_type": "tochg", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#17becf"}}, {"from": "-8608577930118051840", "to": "27", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 27\ntype: chg_step\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-8608577930118051840", "to": "28", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8608577930118051840 → 28\ntype: chg_step\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "10", "to": "-4728362194768353280", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 10 → -4728362194768353280\ntype: tochg\nflow: 0\ncost: 1\ncapacity: ∞", "edge_type": "tochg", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#17becf"}}, {"from": "-8500640205483802624", "to": "43", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -8500640205483802624 → 43\ntype: chg_step\nflow: 0\ncost: -0.2\ncapacity: ∞", "edge_type": "chg_step", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#2ca02c"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-5303467566796545024", "to": "-8500640205483802624", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: -5303467566796545024 → -8500640205483802624\ntype: chg_occ\nflow: 60\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 60.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-5204973881738096640", "to": "-8608577930118051840", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: -5204973881738096640 → -8608577930118051840\ntype: chg_occ\nflow: 0\ncost: 1\ncapacity: 60\n⚠️ Capacity shared across SOC levels", "edge_type": "chg_occ", "flow": 0.0, "dashes": true, "label": "60", "color": {"color": "#ff7f0e"}}, {"from": "-2065537959644669696", "to": "10", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: -2065537959644669696 → 10\ntype: from_source\nflow: 180\ncost: 0\ncapacity: ∞", "edge_type": "from_source", "flow": 180.0, "dashes": true, "label": "∞", "color": {"color": "#d62728"}}, {"from": "-2065537959644669696", "to": "54", "arrows": "to", "width": 5, "smooth": false, "title": "Edge: -2065537959644669696 → 54\ntype: from_source\nflow: 20\ncost: 0\ncapacity: ∞", "edge_type": "from_source", "flow": 20.0, "dashes": true, "label": "∞", "color": {"color": "#d62728"}}, {"from": "33", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 33 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "34", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 34 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "35", "to": "-8724511148913573888", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 35 → -8724511148913573888\ntype: to_sink\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "36", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 36 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "37", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 37 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "38", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 38 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "39", "to": "-8724511148913573888", "arrows": "to", "width": 4, "smooth": false, "title": "Edge: 39 → -8724511148913573888\ntype: to_sink\nflow: 10\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 10.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "40", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 40 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "41", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 41 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "42", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 42 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "43", "to": "-8724511148913573888", "arrows": "to", "width": 6, "smooth": false, "title": "Edge: 43 → -8724511148913573888\ntype: to_sink\nflow: 160\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 160.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "77", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 77 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "78", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 78 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "79", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 79 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "80", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 80 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "81", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 81 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "82", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 82 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "83", "to": "-8724511148913573888", "arrows": "to", "width": 5, "smooth": false, "title": "Edge: 83 → -8724511148913573888\ntype: to_sink\nflow: 20\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 20.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "84", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 84 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "85", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 85 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "86", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 86 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}, {"from": "87", "to": "-8724511148913573888", "arrows": "to", "width": 1, "smooth": false, "title": "Edge: 87 → -8724511148913573888\ntype: to_sink\nflow: 0\ncost: 0\ncapacity: ∞", "edge_type": "to_sink", "flow": 0.0, "dashes": true, "label": "∞", "color": {"color": "#bcbd22"}}];
    const FOCUS = { xGap: 260, yGap: 110, maxCols: 6, centerSize: 11 };
    const PATH  = { xGap: 260,  yGap: 110,  maxCols: 7, centerSize: 11 };

    const nodes = new vis.DataSet(ALL_NODES);
    let edges = new vis.DataSet(ALL_EDGES);

    const options = {
      physics: false,
      interaction: { hover: true, zoomView: true, dragView: true },
      nodes: { shape: 'dot', font: { size: 1 } },
      edges: { 
        smooth: false, 
        arrows: 'to',
        font: { size: 12, color: '#333' },
        labelHighlightBold: false
      }
    };
    const network = new vis.Network(document.getElementById('network'), { nodes, edges }, options);

    // 保存原始坐标用于恢复
    const ORIG_POS = {};
    nodes.get().forEach(n => { ORIG_POS[n.id] = { x: n.x, y: n.y, size: n.size ?? 8 }; });

    // 状态
    let focusedNodeId = null;
    let tracedCenterId = null;

    // 标签切换
    document.getElementById('toggleLabels').addEventListener('change', e => {
      const show = e.target.checked;
      nodes.update(nodes.get().map(n => ({ id: n.id, label: show ? String(n.id) : ' ' })));
    });

    function getPathDir() {
      const el = document.querySelector('input[name="pathdir"]:checked');
      return el ? el.value : 'both';
    }

    // 点击优先级：trace path > focus
    network.on('click', params => {
      if (!(params.nodes && params.nodes.length > 0)) return;
      const nid = String(params.nodes[0]);
      if (document.getElementById('tracePath').checked) {
        tracedCenterId = nid; focusedNodeId = null; applyFilters(); return;
      }
      if (document.getElementById('focusOnClick').checked) {
        focusedNodeId = nid; tracedCenterId = null; applyFilters();
      }
    });
    document.getElementById('clearFocus').addEventListener('click', () => { focusedNodeId = null; applyFilters(); });
    document.getElementById('clearPath').addEventListener('click', () => { tracedCenterId = null; applyFilters(); });
    document.querySelectorAll('input[name="pathdir"]').forEach(r => r.addEventListener('change', () => {
      if (tracedCenterId !== null && document.getElementById('tracePath').checked) applyFilters();
    }));

    function restoreOriginalLayout() {
      const upd = nodes.get().map(n => ({
        id: n.id, x: ORIG_POS[n.id]?.x, y: ORIG_POS[n.id]?.y,
        size: ORIG_POS[n.id]?.size ?? n.size, fixed: true, hidden: n.hidden
      }));
      nodes.update(upd);
    }

    // 网格摆放
    function gridPlace(list, baseX, baseY, gapX, gapY, maxCols) {
      const n = list.length; if (n === 0) return {};
      const cols = Math.min(maxCols, Math.max(1, Math.ceil(Math.sqrt(n))));
      const rows = Math.ceil(n / cols);
      const pos = {};
      for (let i = 0; i < n; i++) {
        const r = Math.floor(i / cols), c = i % cols;
        const x = baseX + (c - (cols - 1) / 2) * (gapX / 2);
        const y = baseY + (r - (rows - 1) / 2) * gapY;
        pos[list[i]] = { x, y };
      }
      return pos;
    }

    // ======= 有向通路（flow>0） + 动态重排 =======
    function showDirectedPathRelayout(centerId, dir) {
      // 1) 仅 flow>0 的有向邻接
      const outAdj = new Map(), inAdj = new Map();
      const posEdges = [];
      for (const e of ALL_EDGES) {
        if (!(e.flow > 0)) continue;
        posEdges.push(e);
        if (!outAdj.has(e.from)) outAdj.set(e.from, []);
        if (!inAdj.has(e.to))    inAdj.set(e.to, []);
        outAdj.get(e.from).push(e.to);
        inAdj.get(e.to).push(e.from);
      }

      // 2) BFS 距离
      function bfs(start, adjMap) {
        const dist = new Map([[start, 0]]), q = [start];
        while (q.length) {
          const u = q.shift();
          for (const v of (adjMap.get(u) || [])) {
            if (!dist.has(v)) { dist.set(v, dist.get(u) + 1); q.push(v); }
          }
        }
        return dist;
      }
      const distF = (dir === 'forward' || dir === 'both') ? bfs(centerId, outAdj) : new Map([[centerId,0]]);
      const distB = (dir === 'backward' || dir === 'both') ? bfs(centerId, inAdj ) : new Map([[centerId,0]]);

      // 3) 选节点并分层（左负右正）
      const keep = new Set([centerId]);
      for (const k of distF.keys()) keep.add(k);
      for (const k of distB.keys()) keep.add(k);

      const layer = new Map([[centerId, 0]]);
      keep.forEach(nid => {
        if (nid === centerId) return;
        const inF = distF.has(nid), inB = distB.has(nid);
        if (dir === 'forward' && inF) layer.set(nid, +distF.get(nid));
        else if (dir === 'backward' && inB) layer.set(nid, -distB.get(nid));
        else if (dir === 'both') {
          if (inF && !inB) layer.set(nid, +distF.get(nid));
          else if (!inF && inB) layer.set(nid, -distB.get(nid));
          else if (inF && inB) layer.set(nid, (distF.get(nid) <= distB.get(nid)) ? +distF.get(nid) : -distB.get(nid));
        }
      });

      // 4) 布局与显示
      const byLayer = new Map();
      for (const nid of keep) {
        const lv = layer.get(nid); if (lv === undefined) continue;
        if (!byLayer.has(lv)) byLayer.set(lv, []);
        byLayer.get(lv).push(nid);
      }
      nodes.update(nodes.get().map(n => ({ id: n.id, hidden: !keep.has(n.id) })));

      const updates = [{ id: centerId, x: 0, y: 0, size: PATH.centerSize, fixed: true }];
      for (const [lv, arr] of Array.from(byLayer.entries()).sort((a,b)=>a[0]-b[0])) {
        if (lv === 0) continue;
        const baseX = lv * PATH.xGap, baseY = 0;
        const pos = gridPlace(arr, baseX, baseY, PATH.xGap, PATH.yGap, PATH.maxCols);
        for (const [id,p] of Object.entries(pos)) updates.push({ id, x:p.x, y:p.y, fixed:true });
      }
      nodes.update(updates);

      // 5) 仅显示通路上的 flow>0 边
      const keepEdges = [];
      const seen = new Set();
      for (const e of posEdges) {
        if (keep.has(e.from) && keep.has(e.to)) {
          const key = e.from + "->" + e.to + "|" + e.edge_type + "|" + (e.cost ?? "");
          if (!seen.has(key)) { seen.add(key); keepEdges.push({ ...e, hidden: false }); }
        }
      }
      edges.clear(); edges.add(keepEdges);

      // 视图对齐
      network.fit({ nodes: Array.from(keep), animation: { duration: 250, easingFunction: "easeInOutQuad" } });
    }

    // ======= 聚焦动态重排 =======
    function relayoutFocus(centerId) {
      const inSet  = new Set();
      const outSet = new Set();
      ALL_EDGES.forEach(e => { if (e.to === centerId && !inSet.has(e.from)) inSet.add(e.from);
                               if (e.from === centerId && !outSet.has(e.to)) outSet.add(e.to); });
      const biSet = new Set();
      for (const n of Array.from(inSet)) if (outSet.has(n)) { biSet.add(n); inSet.delete(n); outSet.delete(n); }

      const inList  = Array.from(inSet);
      const outList = Array.from(outSet);
      const biList  = Array.from(biSet);

      const keep = new Set([centerId, ...inList, ...outList, ...biList]);
      nodes.update(nodes.get().map(n => ({ id: n.id, hidden: !keep.has(n.id) })));

      const updates = [{ id: centerId, x: 0, y: 0, size: FOCUS.centerSize, fixed: true }];
      const posIn  = gridPlace(inList,  -FOCUS.xGap, 0, FOCUS.xGap, FOCUS.yGap, FOCUS.maxCols);
      const posOut = gridPlace(outList, +FOCUS.xGap, 0, FOCUS.xGap, FOCUS.yGap, FOCUS.maxCols);
      const posBi  = gridPlace(biList,  0, FOCUS.yGap*1.4, FOCUS.xGap, FOCUS.yGap, FOCUS.maxCols);
      for (const [id,p] of Object.entries(posIn))  updates.push({ id, x:p.x, y:p.y, fixed:true });
      for (const [id,p] of Object.entries(posOut)) updates.push({ id, x:p.x, y:p.y, fixed:true });
      for (const [id,p] of Object.entries(posBi))  updates.push({ id, x:p.x, y:p.y, fixed:true });
      nodes.update(updates);

      const focusEdges = ALL_EDGES.filter(e => e.from === centerId || e.to === centerId).map(e => ({ ...e, hidden: false }));
      edges.clear(); edges.add(focusEdges);
      network.fit({ nodes: Array.from(keep), animation: { duration: 250, easingFunction: "easeInOutQuad" } });
    }

    // 统一过滤
    function applyFilters() {
      // 1) 通路模式（有向 + 动态重排）
      if (tracedCenterId !== null && document.getElementById('tracePath').checked) {
        restoreOriginalLayout();  // 先恢复坐标，再重排通路
        showDirectedPathRelayout(tracedCenterId, getPathDir());
        return;
      }
      // 2) 聚焦模式
      if (focusedNodeId !== null && document.getElementById('focusOnClick').checked) {
        relayoutFocus(focusedNodeId);
        return;
      }

      // 3) 常规筛选
      const allowedEdgeTypes = new Set(Array.from(document.querySelectorAll('.etype')).filter(b => b.checked).map(b => b.value));
      const allowedVCats    = new Set(Array.from(document.querySelectorAll('.vcat')).filter(b => b.checked).map(b => b.value));
      const flowOnly        = document.getElementById('flowOnly').checked;
      const showVirtual     = document.getElementById('showVirtual').checked;

      const hiddenInit = new Set();
      nodes.get().forEach(n => {
        if (n.is_virtual) {
          const ok = showVirtual && allowedVCats.has(n.vcat);
          if (!ok) hiddenInit.add(n.id);
        }
      });

      const candidateEdges = ALL_EDGES.filter(e =>
        allowedEdgeTypes.has(e.edge_type) && (!flowOnly || e.flow > 0)
      );

      const activeNodeIds = new Set();
      candidateEdges.forEach(e => {
        if (!hiddenInit.has(e.from) && !hiddenInit.has(e.to)) {
          activeNodeIds.add(e.from); activeNodeIds.add(e.to);
        }
      });

      const finalHidden = new Set(hiddenInit);
      if (flowOnly) {
        nodes.get().forEach(n => {
          if (!finalHidden.has(n.id) && !activeNodeIds.has(n.id)) finalHidden.add(n.id);
        });
      }

      restoreOriginalLayout();
      nodes.update(nodes.get().map(n => ({ id: n.id, hidden: finalHidden.has(n.id) })));

      const filtered = ALL_EDGES.map(e => ({
        ...e,
        hidden: !(
          allowedEdgeTypes.has(e.edge_type) &&
          (!flowOnly || e.flow > 0) &&
          !finalHidden.has(e.from) &&
          !finalHidden.has(e.to)
        )
      }));
      edges.clear(); edges.add(filtered);
    }

    // 常规控件
    document.getElementById('flowOnly').addEventListener('change', applyFilters);
    document.getElementById('showVirtual').addEventListener('change', applyFilters);
    document.querySelectorAll('.etype').forEach(b => b.addEventListener('change', applyFilters));
    document.querySelectorAll('.vcat').forEach(b => b.addEventListener('change', applyFilters));
  </script>
</body>
</html>
