# SAEV运营优化图结构求解结果可视化方案

## 项目概述

本项目为SAEV（共享自动驾驶电动汽车）运营优化图结构求解结果设计了一套完整的可视化方案。该方案能够全面展示基于时空-电量网格的最小费用流优化模型的求解结果，帮助研究人员和运营人员深入理解优化结果。

## 核心挑战

### 1. 数据复杂性
- **大规模数据**: 包含230万+条弧记录，2.6万+个节点
- **多维数据**: 时空-电量三维网格，包含时间、区域、SOC等级
- **多类型弧**: 10种不同类型的弧（idle, reposition, tochg, chg_enter, chg_occ, chg_step, svc_enter, svc_gate, svc_exit, to_sink）
- **稀疏流量**: 仅有1,058条弧有实际流量，占总数的0.05%

### 2. 可视化挑战
- **高维数据**: 需要同时展示时间、空间、电量、流量、成本等多个维度
- **网络复杂性**: 图结构包含真实节点和伪节点，连接关系复杂
- **交互需求**: 需要支持多层次的交互式探索
- **性能要求**: 需要处理大规模数据而不影响可视化性能

## 解决方案架构

### 1. 模块化设计
```
SAEVResultVisualizer
├── 数据加载模块
├── 流量分析模块
├── 时空演化模块
├── 网络拓扑模块
├── 地图可视化模块
├── 仪表板模块
└── 报告生成模块
```

### 2. 多层次可视化
- **宏观层面**: 整体流量分布、成本效益分析
- **中观层面**: 时空演化、区域间流动
- **微观层面**: 具体弧的流量、成本详情
- **交互层面**: 支持钻取、筛选、缩放等操作

## 核心功能

### 1. 流量汇总分析 (`plot_flow_summary`)
- **按弧类型统计**: 展示各类弧的流量分布
- **按时间步统计**: 展示流量随时间的变化
- **成本贡献分析**: 展示各类弧的成本贡献
- **流量分布直方图**: 展示流量值的分布特征

### 2. 时空流量演化 (`plot_spatiotemporal_flow`)
- **时间-流量热力图**: 展示不同弧类型在不同时间的流量
- **SOC-流量分布**: 展示不同电量等级的流量分布
- **区域流量分布**: 展示不同区域的流量活跃度
- **弧类型时间演化**: 展示各类弧随时间的变化趋势

### 3. 网络拓扑可视化 (`plot_network_topology`)
- **节点和边**: 展示网络的基本结构
- **流量权重**: 根据流量大小调整边的粗细
- **类型标识**: 根据弧类型设置边的颜色
- **节点大小**: 根据流量大小调整节点大小

### 4. 交互式地图 (`create_interactive_map`)
- **流量连线**: 在地图上展示区域间的流量
- **充电站标记**: 展示充电站的位置和属性
- **区域标记**: 展示区域中心点
- **悬停信息**: 显示详细的流量和成本信息

### 5. 综合仪表板 (`create_dashboard`)
- **流量分布饼图**: 整体流量分布概览
- **成本分析柱状图**: 成本贡献分析
- **时间演化折线图**: 时间趋势分析
- **区域活跃度**: 区域流量活跃度排名
- **SOC分布**: 电量等级分布
- **效率指标**: 关键性能指标仪表盘

## 技术实现

### 1. 数据预处理
```python
# 合并流量和弧信息
df = flows.merge(arcs, on='arc_id', how='left', suffixes=('_flow', '_arc'))

# 过滤活跃流量
active_flows = df[df['flow'] > 0]
```

### 2. 可视化库选择
- **matplotlib**: 静态图表，高质量PNG输出
- **plotly**: 交互式图表，HTML输出
- **folium**: 地图可视化，交互式地图
- **networkx**: 网络图分析，拓扑结构展示

### 3. 性能优化
- **数据过滤**: 只处理有流量的弧
- **节点限制**: 网络图限制节点数量
- **分批处理**: 大数据集分批可视化
- **缓存机制**: 避免重复计算

## 输出文件

### 1. 静态图表
- `flow_summary.png`: 流量汇总分析
- `network_topology.png`: 网络拓扑图
- `custom_analysis.png`: 自定义分析图表

### 2. 交互式图表
- `spatiotemporal_flow.html`: 时空流量演化
- `interactive_map.html`: 交互式地图
- `dashboard.html`: 综合仪表板

### 3. 文本报告
- `report.txt`: 详细的数据分析报告

## 使用示例

### 基本使用
```python
from visualize_solver_results import SAEVResultVisualizer

# 创建可视化器
visualizer = SAEVResultVisualizer(data_dir="src")

# 生成完整报告
visualizer.generate_report()
```

### 自定义分析
```python
# 流量汇总分析
visualizer.plot_flow_summary("flow_summary.png")

# 网络拓扑图
visualizer.plot_network_topology(max_nodes=50, save_path="network.png")

# 交互式地图
visualizer.create_interactive_map("map.html")
```

## 关键发现

### 1. 流量分布特征
- **总流量**: 2,200单位
- **活跃弧**: 1,058条（占总数的0.05%）
- **主要弧类型**: tochg (202条), reposition (198条), chg_enter (198条)
- **时间分布**: 主要集中在时间步3和6

### 2. 成本结构
- **总成本**: -6,570.48（负成本表示收益）
- **主要成本来源**: chg_step (-8,000), reposition (453.9), chg_occ (487)
- **成本效益**: 充电步骤产生最大收益

### 3. 网络特征
- **区域覆盖**: 涉及221个区域
- **SOC范围**: 0-100等级
- **时间跨度**: 1-8时间步
- **网络密度**: 相对稀疏，主要集中在核心区域

## 扩展功能

### 1. 高级分析
- **聚类分析**: 识别流量模式
- **异常检测**: 发现异常流量
- **预测分析**: 基于历史数据预测
- **敏感性分析**: 参数变化影响

### 2. 交互增强
- **实时更新**: 支持数据实时更新
- **多视图同步**: 多个图表联动
- **自定义筛选**: 支持复杂筛选条件
- **导出功能**: 支持多种格式导出

### 3. 性能优化
- **GPU加速**: 利用GPU进行大规模计算
- **分布式处理**: 支持分布式数据处理
- **缓存优化**: 智能缓存机制
- **增量更新**: 支持增量数据更新

## 总结

本可视化方案成功解决了SAEV运营优化图结构求解结果的可视化挑战，提供了多层次、多角度的分析视角。通过模块化设计和性能优化，能够有效处理大规模数据，为研究人员和运营人员提供深入洞察。

### 主要贡献
1. **全面性**: 覆盖了流量、成本、时空、网络等多个维度
2. **交互性**: 提供了丰富的交互式可视化功能
3. **可扩展性**: 模块化设计支持功能扩展
4. **实用性**: 提供了完整的使用文档和示例

### 应用价值
1. **研究支持**: 帮助研究人员理解优化结果
2. **运营指导**: 为运营决策提供数据支持
3. **问题诊断**: 快速识别运营中的问题
4. **效果评估**: 评估优化策略的效果

这套可视化方案为SAEV运营优化研究提供了强有力的工具支持，有助于推动相关领域的发展。
